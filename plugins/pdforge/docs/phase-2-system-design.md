# é˜¶æ®µ 2ï¼šç³»ç»Ÿè®¾è®¡ (System Design)

> åˆ›å»ºæŠ€æœ¯æ¶æ„è®¾è®¡å’Œæ¶æ„å†³ç­–è®°å½•ï¼ˆADRï¼‰

---

## ğŸ“‹ é˜¶æ®µæ¦‚è¿°

| ç»´åº¦ | è¯´æ˜ |
|------|------|
| **ç›®æ ‡** | åˆ›å»ºæŠ€æœ¯æ¶æ„è®¾è®¡å’Œ ADR |
| **è¾“å…¥** | PRD æ–‡æ¡£ï¼ˆæ¥è‡ªé˜¶æ®µ1ï¼‰ |
| **è¾“å‡º** | ADR + æ¶æ„å›¾ + è®¾è®¡æ–‡æ¡£ |
| **ä¸Šæ¸¸é˜¶æ®µ** | éœ€æ±‚åˆ†æï¼ˆé˜¶æ®µ1ï¼‰ |
| **ä¸‹æ¸¸é˜¶æ®µ** | ä»»åŠ¡è§„åˆ’ï¼ˆé˜¶æ®µ3ï¼‰ |

---

## ğŸ§© ç»„ä»¶æ¸…å•

| ç±»å‹ | åç§° | æ¥æº | è¯´æ˜ |
|------|------|------|------|
| **Agent** | `architect` | PDForge | ç³»ç»Ÿæ¶æ„è®¾è®¡ï¼Œç”Ÿæˆ ADR |
| **Skill** | - | - | æ— ç‰¹å®š Skill |
| **Command** | `/design` | è‡ªå®šä¹‰ | å¿«æ·å…¥å£ |
| **Rule** | `patterns.md` | PDForge | API è®¾è®¡æ¨¡å¼çº¦æŸ |
| **Hook** | - | - | æ— ç‰¹å®š Hook |

---

## ğŸ”§ ç»„ä»¶è¯¦è§£

### 1. architect Agent

**ä¸ºä»€ä¹ˆç”¨ Agent è€Œé Skillï¼Ÿ**

ç³»ç»Ÿè®¾è®¡æ˜¯ä¸€ä¸ª**ç‹¬ç«‹çš„åˆ†æä»»åŠ¡**ï¼š
- åŸºäº PRD è¾“å…¥äº§å‡ºè®¾è®¡æ–‡æ¡£
- ä¸éœ€è¦äº†è§£å®ç°è¿‡ç¨‹ä¸­çš„å¯¹è¯ä¸Šä¸‹æ–‡
- éœ€è¦æ·±åº¦åˆ†æå’Œç»¼åˆåˆ¤æ–­
- æœ‰æ¸…æ™°çš„è¾“å…¥/è¾“å‡ºè¾¹ç•Œ

**Frontmatter é…ç½®**ï¼š

```yaml
---
name: architect
description: ç³»ç»Ÿæ¶æ„è®¾è®¡ï¼Œç”Ÿæˆ ADRã€‚å¤æ‚åŠŸèƒ½éœ€è¦æŠ€æœ¯æ–¹æ¡ˆæ—¶ä½¿ç”¨ã€‚
tools: Read, Grep, Glob, Bash
model: opus
---
```

**èŒè´£**ï¼š

1. åˆ†æ PRD ä¸­çš„æŠ€æœ¯éœ€æ±‚
2. è®¾è®¡ç³»ç»Ÿæ¶æ„
3. ç”Ÿæˆæ¶æ„å†³ç­–è®°å½•ï¼ˆADRï¼‰
4. è¯„ä¼°å¯æ‰©å±•æ€§å’Œé£é™©

**äº§å‡ºæ–‡ä»¶**ï¼š

| æ–‡ä»¶ç±»å‹ | è·¯å¾„ | è¯´æ˜ |
|----------|------|------|
| è®¾è®¡æ–‡æ¡£ | `docs/architecture/[feature]-design.md` | å®Œæ•´æ¶æ„è®¾è®¡ |
| ADR | `docs/adr/[number]-[title].md` | æ¶æ„å†³ç­–è®°å½• |
| æ¶æ„å›¾ | `docs/diagrams/[feature].mermaid` | Mermaid æ ¼å¼æ¶æ„å›¾ |

**ADR æ¨¡æ¿**ï¼š

```markdown
# ADR-[number]: [æ ‡é¢˜]

## çŠ¶æ€
æè®® / æ¥å— / åºŸå¼ƒ

## ä¸Šä¸‹æ–‡
[ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªå†³ç­–]

## å†³ç­–
[æˆ‘ä»¬å†³å®šåšä»€ä¹ˆ]

## åæœ
[æ­£é¢å’Œè´Ÿé¢å½±å“]

## æ›¿ä»£æ–¹æ¡ˆ
[è€ƒè™‘è¿‡ä½†æœªé€‰æ‹©çš„æ–¹æ¡ˆ]
```

---

### 2. patterns.md Rule

**âš ï¸ é‡è¦è¯´æ˜**ï¼šClaude Code **ä¸ä¼šè‡ªåŠ¨åŠ è½½** `rules/` ç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚

**æ­£ç¡®ä½¿ç”¨æ–¹å¼**ï¼š

1. åœ¨ `architect.md` ä¸­æŒ‡ç¤ºè¯»å–ï¼š

```markdown
## MANDATORY: Read Rules Before Designing

**BEFORE designing any API or data model, you MUST:**

1. **Read the patterns file**: Use the `Read` tool to read `rules/patterns.md`
2. **Apply all constraints** from that file to your design
```

2. åœ¨ `CLAUDE.md` ä¸­æ‘˜è¦è¯´æ˜

**patterns.md å†…å®¹ç¤ºä¾‹**ï¼š

```markdown
# API Design Patterns

## RESTful å‘½åçº¦å®š
- ä½¿ç”¨åè¯ï¼Œä¸ç”¨åŠ¨è¯
- å¤æ•°å½¢å¼è¡¨ç¤ºé›†åˆ
- åµŒå¥—èµ„æºè¡¨ç¤ºå…³ç³»

## HTTP çŠ¶æ€ç 
- 200: æˆåŠŸ
- 201: åˆ›å»ºæˆåŠŸ
- 400: å®¢æˆ·ç«¯é”™è¯¯
- 401: æœªè®¤è¯
- 403: æœªæˆæƒ
- 404: èµ„æºä¸å­˜åœ¨
- 500: æœåŠ¡å™¨é”™è¯¯

## å®‰å…¨æ¨¡å¼
- æ‰€æœ‰è¾“å…¥å¿…é¡»éªŒè¯
- æ•æ„Ÿæ•°æ®å¿…é¡»åŠ å¯†
- ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢é˜²æ­¢ SQL æ³¨å…¥
```

---

### 3. /design å‘½ä»¤

**è¯­æ³•**ï¼š

```bash
/design <prd_path>
/design <prd_path> --focus <é¢†åŸŸ>
/design <prd_path> --constraints "<çº¦æŸæ¡ä»¶>"
/design <prd_path> --existing <ç°æœ‰æ¶æ„æ–‡æ¡£>
```

**å‚æ•°**ï¼š

| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `<prd_path>` | PRD æ–‡æ¡£è·¯å¾„ï¼ˆå¿…éœ€ï¼‰ | `docs/prd/auth.md` |
| `--focus` | è®¾è®¡é‡ç‚¹é¢†åŸŸ | `security`, `performance`, `scalability` |
| `--constraints` | é¢å¤–çº¦æŸæ¡ä»¶ | `"å¿…é¡»ä½¿ç”¨ PostgreSQL"` |
| `--existing` | ç°æœ‰æ¶æ„æ–‡æ¡£ | `docs/architecture/overview.md` |

**ç¤ºä¾‹**ï¼š

```bash
# åŸºæœ¬ç”¨æ³•
/design docs/prd/user-auth.md

# å¸¦è®¾è®¡é‡ç‚¹
/design docs/prd/payment.md --focus security

# å¸¦çº¦æŸæ¡ä»¶
/design docs/prd/payment-system.md \
  --constraints "å¿…é¡»ä½¿ç”¨ PostgreSQL, å›¢é˜Ÿ 2 äºº, 3 å‘¨æ—¶é—´"

# å¢é‡è®¾è®¡ï¼ˆæœ‰ç°æœ‰æ¶æ„ï¼‰
/design docs/prd/new-feature.md \
  --existing docs/architecture/system-overview.md
```

---

## ğŸš€ ä½¿ç”¨æµç¨‹

### æ ‡å‡†æµç¨‹

```bash
# Step 1: ç¡®ä¿ PRD å·²å®Œæˆ
# æ–‡ä»¶ä½ç½®: docs/prd/user-authentication.md

# Step 2: å¯åŠ¨ç³»ç»Ÿè®¾è®¡
/design docs/prd/user-authentication.md

# Step 3: architect agent æ‰§è¡Œ:
#    - è¯»å– PRD
#    - è¯»å– patterns.md è§„åˆ™
#    - åˆ†ææŠ€æœ¯éœ€æ±‚
#    - è®¾è®¡ç³»ç»Ÿæ¶æ„
#    - ç”Ÿæˆ ADR

# Step 4: äº§å‡ºæ–‡ä»¶:
#    docs/architecture/user-authentication-design.md
#    docs/adr/001-jwt-vs-session.md
#    docs/adr/002-password-hashing-algorithm.md
#    docs/diagrams/user-authentication.mermaid
```

### å¸¦çº¦æŸçš„è®¾è®¡

```bash
/design docs/prd/payment-system.md \
  --constraints "å¿…é¡»ä½¿ç”¨ PostgreSQL, ç¬¦åˆ PCI DSS" \
  --focus security
```

### å¢é‡è®¾è®¡

```bash
# åœ¨ç°æœ‰æ¶æ„åŸºç¡€ä¸Šæ·»åŠ æ–°åŠŸèƒ½
/design docs/prd/new-feature.md \
  --existing docs/architecture/system-overview.md
```

---

## ğŸ“Š å·¥ä½œæµå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç³»ç»Ÿè®¾è®¡é˜¶æ®µå·¥ä½œæµ                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  è¾“å…¥                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚ PRD æ–‡æ¡£        â”‚ (æ¥è‡ªé˜¶æ®µ1)                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚           â”‚                                                 â”‚
â”‚           â–¼                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ /design å‘½ä»¤    â”‚ â”€â”€â–¶ â”‚ architect agent â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                   â”‚                        â”‚
â”‚                                   â”‚ è¯»å–å¹¶åº”ç”¨               â”‚
â”‚                                   â–¼                        â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚                          â”‚ patterns.md     â”‚               â”‚
â”‚                          â”‚ (Rule)          â”‚               â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                   â”‚                        â”‚
â”‚                                   â–¼                        â”‚
â”‚  è¾“å‡º                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ docs/architecture/[feature]-design.md   è®¾è®¡æ–‡æ¡£     â”‚   â”‚
â”‚  â”‚ docs/adr/[number]-[title].md           ADR          â”‚   â”‚
â”‚  â”‚ docs/diagrams/[feature].mermaid        æ¶æ„å›¾       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš™ï¸ é…ç½®å·®å¼‚

### 0â†’1 äº§å“

```yaml
system_design:
  architect: optional          # å¯é€‰ï¼Œç®€å•åŠŸèƒ½å¯è·³è¿‡
  adr_required: false          # ADR éå¿…éœ€
  patterns_strict: false       # æ¨¡å¼çº¦æŸå®½æ¾
```

**æ¨èåšæ³•**ï¼š
- ç®€å•åŠŸèƒ½å¯è·³è¿‡ architectï¼Œç›´æ¥è¿›å…¥ä»»åŠ¡è§„åˆ’
- å¤æ‚åŠŸèƒ½ä»å»ºè®®åšè®¾è®¡

### 1â†’100 äº§å“

```yaml
system_design:
  architect: required          # å¿…é¡»
  adr_required: true           # ADR å¿…éœ€
  patterns_strict: true        # ä¸¥æ ¼éµå¾ªæ¨¡å¼
```

**æ¨èåšæ³•**ï¼š
- æ‰€æœ‰åŠŸèƒ½å¿…é¡»ç»è¿‡æ¶æ„è®¾è®¡
- å…³é”®å†³ç­–å¿…é¡»æœ‰ ADR è®°å½•

---

## âœ… å®Œæˆæ£€æŸ¥æ¸…å•

åœ¨ç³»ç»Ÿè®¾è®¡é˜¶æ®µå®Œæˆåï¼Œç¡®è®¤ï¼š

- [ ] è®¾è®¡æ–‡æ¡£è¦†ç›–æ‰€æœ‰ PRD éœ€æ±‚
- [ ] å…³é”®æŠ€æœ¯å†³ç­–æœ‰å¯¹åº”çš„ ADR
- [ ] æ¶æ„å›¾æ¸…æ™°å±•ç¤ºç»„ä»¶å…³ç³»
- [ ] å®‰å…¨è€ƒè™‘å·²è®°å½•
- [ ] é£é™©è¯„ä¼°å·²å®Œæˆ
- [ ] å¯æ‰©å±•æ€§å·²è€ƒè™‘
- [ ] è®¾è®¡æ–‡æ¡£å·²ç»è¿‡å›¢é˜Ÿè¯„å®¡ï¼ˆ1â†’100 äº§å“ï¼‰

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **Rules ä¸ä¼šè‡ªåŠ¨åŠ è½½**ï¼šå¿…é¡»åœ¨ Agent ä¸­æŒ‡ç¤ºè¯»å– `patterns.md`
2. **ADR ä¸å¯ä¿®æ”¹**ï¼šå·²æ¥å—çš„ ADR ä¸åº”ä¿®æ”¹ï¼Œå˜æ›´åº”åˆ›å»ºæ–° ADR
3. **è®¾è®¡å˜æ›´è¿½è¸ª**ï¼šæ–° ADR åº”å¼•ç”¨è¢«æ›¿ä»£çš„ ADR
4. **patterns.md æ˜¯çº¦æŸä¸æ˜¯æµç¨‹**ï¼šæ‰€ä»¥ç”¨ Rule è€Œé Skill

---

## ğŸ”— ä¸‹ä¸€é˜¶æ®µ

å®Œæˆç³»ç»Ÿè®¾è®¡åï¼Œè¿›å…¥ **é˜¶æ®µ 3ï¼šä»»åŠ¡è§„åˆ’**ï¼š

```bash
/plan docs/architecture/user-auth-design.md
```

æˆ–ç›´æ¥ä½¿ç”¨ PRDï¼š

```bash
/plan docs/prd/user-auth-prd.md --design docs/architecture/user-auth-design.md
```
