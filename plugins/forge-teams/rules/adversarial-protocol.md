---
name: adversarial-protocol
description: 对抗辩论通用规则，适用于需求、设计、审查、调试所有对抗阶段。
---

# Adversarial Protocol Rules

本规则定义 forge-teams 中所有对抗阶段的行为准则。适用于 Phase 1 (需求辩论)、Phase 2 (架构竞标)、Phase 5 (红队审查)、Phase 6 (对抗调试) 的所有参与 agent。

**核心信念**: 经过对抗检验的结论，比任何个体的"最优判断"都更可靠。

---

## Rule 1: Evidence First (证据优先)

所有论点**必须**有具体证据支持。没有证据的论点将被忽略。

| 允许 | 禁止 |
|------|------|
| "在 `src/auth.ts:42` 发现未处理的 null 检查" | "我觉得可能有 null 的问题" |
| "PRD 第 3.2 节要求支持 OAuth2，但当前实现缺失" | "需求好像没有完全满足" |
| "运行 `npm test` 输出 3 个失败用例，见附件" | "测试可能有些问题" |
| "git bisect 定位到 commit `abc123` 引入了回归" | "最近的改动可能导致了问题" |
| "性能测试显示 P99 延迟从 50ms 增加到 500ms" | "性能不太好" |

**证据类型优先级**:

| 优先级 | 证据类型 | 示例 |
|--------|---------|------|
| 1 | 可重现的代码执行结果 | 测试输出、命令行输出 |
| 2 | 代码引用（文件 + 行号） | `src/api/handler.ts:127` |
| 3 | 文档引用 | PRD 第 X 节、ADR 决策 #N |
| 4 | 数据对比 | 性能数据、覆盖率报告 |
| 5 | 逻辑推理（必须完整） | "如果 A 且 B，则必然 C" |

**标准**: 如果你不能指向一个具体的文件、行号、命令输出、文档章节或数据，那它不算证据。

---

## Rule 2: Falsifiability (可证伪性)

每个论点、假设或方案**必须**有明确的否定条件。

| 允许 | 禁止 |
|------|------|
| "如果是竞态条件，那并发测试应该能复现" | "代码质量不好导致了问题" |
| "方案 A 在 1000 QPS 下延迟应 < 100ms，否则不可行" | "方案 A 性能更好" |
| "如果 PRD 要求的 5 个用例都有测试覆盖，则合规" | "实现应该是合规的" |

**可证伪性模板**:

```markdown
论点: [具体论点]
验证方式: [如何证实]
否定条件: [什么情况下论点被否定]
```

示例:
```markdown
论点: 内存泄漏导致服务在长时间运行后 OOM
验证方式: 运行 24 小时压力测试，监控内存使用曲线
否定条件: 如果内存使用曲线稳定（无持续增长），则排除内存泄漏
```

**标准**: 如果你无法描述"在什么条件下你的论点是错的"，那它不是一个有效论点。

---

## Rule 3: Independence (独立调查)

对抗阶段中的每个参与者**必须**独立形成自己的判断。

| 允许 | 禁止 |
|------|------|
| 独立调查后提交报告 | 偷看其他参与者的报告后调整自己的结论 |
| 基于自己的证据论证 | "我同意 Agent-A 的观点"（无独立证据） |
| 报告否定自己假设的证据 | 因为另一个假设更强就放弃调查 |

**独立性检验标准**: 你的结论应该和你是否知道其他参与者的立场无关。如果知道别人的立场后你改变了结论，你需要提供新的独立证据解释为什么改变。

### 对抗阶段特定的独立性要求

| 阶段 | 独立性要求 |
|------|-----------|
| P1 需求辩论 | 乐观和悲观分析师不得互相影响初始分析 |
| P2 架构竞标 | 两个架构师不得看对方方案 |
| P5 红队审查 | 红队不得提前知道蓝队的防御策略 |
| P6 对抗调试 | 调查员不得看其他调查员的发现 |

---

## Rule 4: Honest Reporting (诚实报告)

所有发现**必须**完整报告，包括不利于自己立场的证据。

| 允许 | 禁止 |
|------|------|
| 报告支持 + 反对证据，调整置信度 | 只报告支持自己立场的证据 |
| "发现 3 处支持证据，但 1 处反证" | "发现 3 处证据支持我的假设" |
| 主动降低置信度当证据不足时 | 维持高置信度忽略反证 |

**诚实报告模板**:

```markdown
[EVIDENCE REPORT]
Position: [我的立场/假设]

Supporting Evidence:
  1. [证据 1] - [来源]
  2. [证据 2] - [来源]

Contrary Evidence:
  1. [反证 1] - [来源]
  2. [反证 2] - [来源]

Confidence Adjustment:
  Initial: X/10
  Current: Y/10
  Reason: [为什么调整]
```

**违规后果**: 如果被其他参与者或 Lead 发现隐藏不利证据，该参与者的所有结论将被标记为**不可信**，其假设/方案将被降权。

---

## Rule 5: Constructive Challenge (建设性挑战)

挑战**必须**是建设性的，目标是改进而非否定。

| 允许 | 禁止 |
|------|------|
| "你的证据展示了相关性，但因果关系需要额外验证..." | "这个假设不对" |
| "我在 `config.ts:18` 发现了反证..." | "你没看仔细" |
| "如果你的方案正确，那 X 场景应该也能处理，但是..." | "再想想" |
| "你的架构在高并发下会遇到 Y 问题，因为..." | "这个架构不行" |

**挑战消息模板**:

```markdown
[CHALLENGE]
Target: [被挑战的论点/假设/方案]
Challenge Type: Evidence Quality | Logic Flaw | Counter Evidence | Missing Case | Scalability
Challenge: [具体挑战内容]
Evidence: [支持挑战的证据]
Expected Response: [期望对方如何回应]
```

**挑战类型说明**:

| 类型 | 说明 | 示例 |
|------|------|------|
| Evidence Quality | 质疑证据的质量或相关性 | "你的测试只覆盖了 happy path" |
| Logic Flaw | 指出推理链中的逻辑错误 | "从 A 推不出 B，因为..." |
| Counter Evidence | 提供反面证据 | "但在 X 文件中，同样的模式正常工作" |
| Missing Case | 指出未考虑的边界情况 | "你没有处理空数组的情况" |
| Scalability | 质疑方案的可扩展性 | "当数据量增长 10x 后..." |

---

## Rule 6: Accept Valid Responses (接受有效回应)

当挑战被有效回应时，**必须**承认并停止在同一点上纠缠。

| 允许 | 禁止 |
|------|------|
| "你的回应解答了我的质疑，我撤回这个挑战" | 反复质疑已有效回应的同一个点 |
| "你补充的证据让我把该假设从 3/10 调到 7/10" | 忽视有效回应继续攻击 |
| "你的测试确实覆盖了我提到的边界情况" | "虽然你回答了，但我还是觉得..." |

**有效回应的判定标准**:

一个回应被认为"有效"当且仅当：
1. 直接针对挑战的核心问题
2. 提供了新的证据或合理的逻辑推理
3. 不回避挑战中提出的具体问题

如果对"有效性"存在争议，由 Lead 或 Arbitrator 仲裁。

---

## Rule 7: Convergence Discipline (收敛纪律)

对抗辩论**必须**在有限轮次内收敛。无限辩论是反模式。

**最大轮次**: 3 轮

| 收敛类型 | 条件 | 动作 |
|---------|------|------|
| 强收敛 | 一个立场 >= 8/10 且所有挑战已回应 | 可提前结束 |
| 弱收敛 | 领先立场超出次位 >= 3 分 | 再一轮确认后结束 |
| 无收敛 | 3 轮后多个立场相近 | 仲裁者/综合员强制判定 |

**每轮辩论的时间预算**:

| 步骤 | 最大时间 |
|------|---------|
| 调查/分析 | 与任务复杂度成正比 |
| 报告 | 立即提交 |
| 挑战 | 收到报告后 |
| 回应 | 收到挑战后 |
| 综合/仲裁 | 所有回应完成后 |

**标准**: 完美是好的敌人。3 轮后的最佳结论比无限辩论更有价值。第 4 轮以后的边际收益通常不值得额外 token 消耗。

---

## Rule 8: Role Boundaries (角色边界)

每个角色**必须**坚守自己的职责，不得越界。

### Phase 1: 需求辩论

| 角色 | 允许 | 禁止 |
|------|------|------|
| Optimist Analyst | 分析可行性、用户价值 | 提出技术方案 |
| Pessimist Analyst | 分析风险、边界情况 | 否决需求本身 |
| User Advocate | 代表用户视角 | 技术判断 |
| Lead (Arbitrator) | 仲裁、综合 PRD | 提出自己的需求分析 |

### Phase 2: 架构竞标

| 角色 | 允许 | 禁止 |
|------|------|------|
| Architect A/B | 设计方案、论证优势 | 评审对方方案 |
| Review Panel | 评审方案、给出评分 | 提出自己的方案 |
| Lead | 基于评审选择/融合 | 直接否定所有方案 |

### Phase 5: 红队审查

| 角色 | 允许 | 禁止 |
|------|------|------|
| Red Team | 攻击、寻找漏洞 | 提出修复方案 |
| Blue Team | 防御、评估风险 | 发起攻击 |
| Arbitrator | 仲裁争议 | 自己攻击或防御 |

### Phase 6: 对抗调试

| 角色 | 允许 | 禁止 |
|------|------|------|
| Investigator | 调查假设、收集证据 | 挑战其他调查员、做最终判定 |
| Devil's Advocate | 挑战假设、寻找反证 | 提出自己的假设 |
| Evidence Synthesizer | 综合证据、做最终判定 | 调查假设、发起挑战 |

**违规后果**: Lead 立即纠正角色越界行为。如果 teammate 持续越界，可以 shutdown 并 spawn 新 teammate 替代。

---

## Rule 9: Communication Format (通信格式标准)

所有对抗阶段的通信**必须**使用标准化格式，确保信息结构清晰。

### 9.1 论点提交

```
[ARGUMENT]
Phase: [阶段编号]
Round: [辩论轮次]
Role: [角色名称]
Position: [立场概述，一句话]
---
Evidence:
  1. [证据描述] | Source: [文件:行号 或 命令输出]
  2. [证据描述] | Source: [文件:行号 或 命令输出]
---
Confidence: X/10
Falsification Condition: [什么条件下我是错的]
```

### 9.2 挑战提交

```
[CHALLENGE]
Phase: [阶段编号]
Round: [辩论轮次]
From: [挑战者角色]
To: [被挑战者角色]
Target: [被挑战的具体论点]
---
Challenge Type: [Evidence Quality | Logic Flaw | Counter Evidence | Missing Case | Scalability]
Challenge: [挑战内容]
Evidence: [支持挑战的证据]
---
Expected Response: [期望对方如何回应]
```

### 9.3 回应提交

```
[RESPONSE]
Phase: [阶段编号]
Round: [辩论轮次]
From: [回应者角色]
To: [挑战者角色]
Challenge Ref: [被回应的挑战标题]
---
Response: [回应内容]
New Evidence: [补充证据]
---
Confidence Update: X/10 -> Y/10
```

### 9.4 综合判定

```
[SYNTHESIS]
Phase: [阶段编号]
Round: [辩论轮次]
---
Active Positions: [仍在竞争的立场]
Eliminated: [已被淘汰的立场 + 原因]
Leading: [当前领先立场]
Convergence Status: [STRONG | WEAK | NONE]
---
Recommendation: [推荐结论]
Confidence: X/10
```

---

## Rule 10: Violation Consequences (违规后果)

所有参与者**必须**遵守以上 9 条规则。违规将产生以下后果：

| 违规 | 严重程度 | 后果 |
|------|---------|------|
| 无证据的论点 | Medium | 论点被忽略，不计入判定 |
| 隐藏不利证据 | Critical | 该参与者所有结论标记为不可信 |
| 角色越界 | Medium | Lead 立即纠正，严重时替换 teammate |
| 非建设性挑战 | Low | 挑战被忽略，提醒修正 |
| 拒绝有效回应 | Medium | 相关挑战视为已解决 |
| 破坏收敛纪律 | High | Lead 强制结束辩论，进入判定 |
| 不使用标准格式 | Low | 提醒修正格式 |
| 影响其他参与者独立性 | High | 受影响的分析作废，重新独立分析 |
| 辩论超过 3 轮仍坚持 | Medium | 强制进入综合判定 |
| 无否定条件的假设 | Medium | 假设无效，不进入调查 |

### 累计违规处理

| 累计次数 | 处理 |
|---------|------|
| 1 次 | 口头提醒 |
| 2 次 | 书面警告，记入报告 |
| 3 次 | Shutdown teammate，spawn 替代 |

---

## Summary: The 10 Rules at a Glance

```
┌─────────────────────────────────────────────────────────────────────┐
│                  ADVERSARIAL PROTOCOL                                │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  1. EVIDENCE FIRST       所有论点必须有具体证据                       │
│  2. FALSIFIABILITY       所有论点必须有否定条件                       │
│  3. INDEPENDENCE         独立调查，独立判断                           │
│  4. HONEST REPORTING     完整报告，含不利证据                         │
│  5. CONSTRUCTIVE         挑战是为了改进，不是否定                     │
│  6. ACCEPT VALID         有效回应必须被承认                           │
│  7. CONVERGENCE          最多 3 轮，必须收敛                         │
│  8. ROLE BOUNDARIES      坚守角色，不越界                            │
│  9. STANDARD FORMAT      统一通信格式                                │
│ 10. CONSEQUENCES         违规有明确后果                               │
│                                                                     │
│  Core: 对抗的目的是发现真相，不是赢得辩论。                           │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```
